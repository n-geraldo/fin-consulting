const i18n = {
    al: {
      "meta.title": "SADO Finance Consulting - Konsulencë financiare dhe kontabilitet",
      "meta.description":
        "Zgjidhje moderne për kontabilitet, tatime dhe konsulencë financiare për biznese të përgjegjshme.",
      "logo.text": "SADO Finance Consulting",
  
      "topbar.phoneText": "+355 68 239 2034",
      "topbar.emailText": "info@sadoconsulting.al",
      "topbar.follow": "Na ndiqni",
  
      "nav.home": "Hyrje",
      "nav.services": "Shërbimet",
      "nav.about": "Rreth nesh",
      "nav.testimonials": "Dëshmi",
      "nav.contact": "Kontakti",
  
      "header.cta": "Rezervo një konsultë",
  
      "hero.title": "Partneri juaj i qetësisë financiare",
      "hero.subtitle":
        "Ne kombinojmë eksperiencën kontabël dhe teknologjinë moderne për t’ju ndihmuar të merrni vendime të sigurta për biznesin tuaj.",
      "hero.callNow": "Telefono tani",
      "hero.bookConsult": "Rezervo konsultën",
      "hero.point1": "Raporte të qarta mujore dhe të personalizuara",
      "hero.point2": "Ekspertë me përvojë në biznese lokale dhe ndërkombëtare",
      "hero.point3": "Proces i dixhitalizuar me siguri të lartë të të dhënave",
      "hero.cardTitle": "Pamje e qartë mbi performancën tuaj financiare",
      "hero.cardMeta": "Monitorim në kohë reale • Analizë strategjike",
  
      "services.title": "Shërbimet tona kryesore",
      "services.subtitle":
        "Zgjidhje të plota financiare që rritin efikasitetin, uljen e riskut dhe qartësinë në çdo hap.",
      "services.learnMore": "Mëso më shumë",
  
      "services.items.accounting.title": "Kontabilitet i përditësuar",
      "services.items.accounting.description":
        "Regjistrim i saktë i çdo transaksioni, raporte të sakta dhe pasqyrë e plotë financiare në kohë.",
      "services.items.tax.title": "Planifikim tatimor",
      "services.items.tax.description":
        "Optimizim i barrës tatimore dhe përputhje e plotë me legjislacionin në fuqi.",
      "services.items.payroll.title": "Administrim pagash",
      "services.items.payroll.description":
        "Llogaritje e pagave, kontributeve dhe deklarimeve, në kohë dhe pa gabime.",
      "services.items.consulting.title": "Konsulencë strategjike",
      "services.items.consulting.description":
        "Analizë financiare dhe strategji rritjeje të përshtatura për modelin tuaj të biznesit.",
      "services.items.reporting.title": "Raportim menaxherial",
      "services.items.reporting.description":
        "Pasqyra të personalizuara për menaxhim, cash-flow dhe analizë të performancës.",
      "services.items.compliance.title": "Përputhshmëri ligjore",
      "services.items.compliance.description":
        "Monitorim i afateve dhe deklarimeve për të shmangur gjobat dhe penalitetet.",
      "services.items.forecast.title": "Parashikim financiar",
      "services.items.forecast.description":
        "Skenarë financiarë për investime, kredi dhe zgjerim të qëndrueshëm.",
  
      "categories.title": "Shërbime të ndryshme",
      "categories.subtitle":
        "Filtroni sipas kategorisë për të gjetur shërbimin që i përshtatet më së miri fazës ku ndodhet biznesi juaj.",
      "categories.all": "Të gjitha",
      "categories.accounting": "Kontabilitet",
      "categories.taxes": "Tatime",
      "categories.payroll": "Pagat",
      "categories.consulting": "Konsulencë",
  
      "about.title": "Rreth SADO Finance Consulting",
      "about.subtitle":
        "Një ekip specialistësh kontabël, analistësh financiarë dhe këshilltarësh biznesi që punojnë së bashku për t’ju ofruar qartësi dhe siguri.",
      "about.text1":
        "Ne besojmë se çdo vendim i mirë fillon me të dhëna të sakta. Prandaj kemi ndërtuar një qasje ku raportimi financiar, automatizimi dhe komunikimi njerëzor ecin krah për krah.",
      "about.text2":
        "Nga bizneset e vogla që sapo kanë nisur, tek organizatat e konsoliduara, ndihmojmë klientët tanë të kuptojnë shifrat dhe t’i kthejnë ato në veprime konkrete.",
      "about.point1":
        "Mbi 10 vite eksperiencë e kombinuar në financa dhe kontabilitet.",
      "about.point2":
        "Proces pune transparent dhe komunikim i rregullt me klientët.",
      "about.point3":
        "Teknologji moderne për menaxhim dokumentesh dhe raportim online.",
      "about.metric.number": "150+",
      "about.metric.label": "Biznese të mbështetura",
  
      "why.title": "Pse të punoni me ne?",
      "why.subtitle":
        "Kombinojmë ekspertizën, teknologjinë dhe qasjen njerëzore për t’ju ofruar një partneritet afatgjatë.",
      "why.items.trust.title": "Besueshmëri dhe integritet",
      "why.items.trust.point1":
        "Standard i lartë profesionalizmi dhe etikë pune.",
      "why.items.trust.point2":
        "Proces i qartë miratimi për çdo vendim kritik.",
      "why.items.process.title": "Proces i strukturuar",
      "why.items.process.point1":
        "Onboarding i qartë dhe transferim i lehtë i të dhënave.",
      "why.items.process.point2":
        "Raporte të rregullta dhe afate të dakorduara.",
      "why.items.care.title": "Kujdes njerëzor",
      "why.items.care.point1":
        "Këshillim i personalizuar për çdo vendim të rëndësishëm.",
      "why.items.care.point2": "Përgjigje të shpejta dhe komunikim i hapur.",
  
      "social.title": "Përgjegjësia sociale",
      "social.subtitle":
        "Besojmë se suksesin financiar duhet ta ndajmë me komunitetin ku veprojmë.",
      "social.items.education.title": "Edukimi financiar",
      "social.items.education.description":
        "Organizojmë trajnime falas për sipërmarrës të rinj dhe studentë në fushën e financës.",
      "social.items.local.title": "Biznesi lokal",
      "social.items.local.description":
        "Bashkëpunojmë me biznese lokale dhe ofrojmë kushte të favorshme për start-up-et.",
      "social.items.environment.title": "Mjedisi",
      "social.items.environment.description":
        "Ulje e përdorimit të letrës përmes proceseve tërësisht dixhitale.",
      "social.items.ethics.title": "Etika dhe transparenca",
      "social.items.ethics.description":
        "Rregulla të qarta pune dhe raportim i ndershëm për çdo çështje financiare.",
  
      "testimonials.title": "Çfarë thonë klientët tanë",
      "testimonials.subtitle":
        "Biznese nga sektorë të ndryshëm që na kanë besuar llogaritë dhe planet e tyre financiare.",
      "testimonials.items.1.quote":
        "“Falë raporteve të rregullta dhe këshillave të tyre, sot kemi një pasqyrë krejt tjetër mbi fitueshmërinë e biznesit.”",
      "testimonials.items.1.name": "Arben Kola",
      "testimonials.items.1.role": "Pronari i një biznesi tregtar",
      "testimonials.items.2.quote":
        "“Procesi i pagave është automatizuar dhe stafi ynë merr gjithmonë informacion të saktë dhe në kohë.”",
      "testimonials.items.2.name": "Erisa Mema",
      "testimonials.items.2.role": "Drejtuese burimesh njerëzore",
      "testimonials.items.3.quote":
        "“Këshillat e tyre për strukturimin e financave na ndihmuan të siguronim një financim të rëndësishëm për zgjerim.”",
      "testimonials.items.3.name": "Luan Dervishi",
      "testimonials.items.3.role": "Bashkë-themelues i një start-up-i teknologjik",
      "testimonials.items.4.quote":
        "“Ndjehemi të sigurt përpara çdo kontrolli tatimor falë dokumentacionit të plotë që ata përgatisin.”",
      "testimonials.items.4.name": "Eglantina Muka",
      "testimonials.items.4.role": "Drejtoreshë financiare",
  
      "finalCta.title":
        "Gati të sillni qartësi në financat e biznesit tuaj?",
      "finalCta.subtitle":
        "Na lini një mesazh dhe do t’ju kontaktojmë për një konsultë falas fillestare.",
      "finalCta.button": "Na kontakto",
  
      "contact.title": "Kontaktoni me ekipin tonë",
      "contact.subtitle":
        "Plotësoni formularin dhe do të rikthehemi tek ju me një propozim të personalizuar brenda një dite pune.",
      "contact.phoneLabel": "Telefon:",
      "contact.emailLabel": "Email:",
      "contact.addressLabel": "Adresë:",
      "contact.addressValue": "Yzberisht,Tirane, Albania",
  
      "form.nameLabel": "Emri dhe mbiemri",
      "form.namePlaceholder": "Shkruani emrin tuaj",
      "form.emailLabel": "Email",
      "form.emailPlaceholder": "Shkruani adresën tuaj të emailit",
      "form.messageLabel": "Mesazhi",
      "form.messagePlaceholder": "Na tregoni pak më shumë rreth nevojës suaj",
      "form.submit": "Dërgo mesazhin",
  
      "form.error.required": "Ky fushë është e detyrueshme.",
      "form.error.email": "Ju lutem shkruani një adresë emaili të vlefshme.",
      "form.success":
        "Faleminderit! Mesazhi juaj u dërgua. Do t’ju kontaktojmë së shpejti.",
  
      "toast.serviceModalTitlePrefix": "Më shumë rreth: ",
  
      "footer.logo": "SADO Finance Consulting",
      "footer.about":
        "Një ekip profesionistësh që e sheh kontabilitetin jo vetëm si detyrim ligjor, por si mjet për rritjen e biznesit tuaj.",
      "footer.linksTitle": "Linqe të shpejta",
      "footer.servicesTitle": "Shërbime",
      "footer.contactTitle": "Kontakti",
      "footer.copyright":
        "© 2026 SADO Finance Consulting. Të gjitha të drejtat e rezervuara.",
    },
    en: {
      "meta.title": "SADO Finance Consulting - Financial consulting and accounting",
      "meta.description":
        "Modern solutions for accounting, tax and financial consulting for responsible businesses.",
      "logo.text": "SADO Finance Consulting",
  
      "topbar.phoneText": "+355 68 239 2034",
      "topbar.emailText": "info@sadoconsulting.al",
      "topbar.follow": "Follow us",
  
      "nav.home": "Home",
      "nav.services": "Services",
      "nav.about": "About",
      "nav.testimonials": "Testimonials",
      "nav.contact": "Contact",
  
      "header.cta": "Book a consult",
  
      "hero.title": "Your partner for financial clarity",
      "hero.subtitle":
        "We combine accounting expertise and modern technology to help you make confident decisions for your business.",
      "hero.callNow": "Call now",
      "hero.bookConsult": "Book consultation",
      "hero.point1": "Clear, customised monthly reporting",
      "hero.point2":
        "Experts with experience in both local and international businesses",
      "hero.point3":
        "Digitised process with high-level security for your data",
      "hero.cardTitle": "A clear view of your financial performance",
      "hero.cardMeta": "Real-time monitoring • Strategic analysis",
  
      "services.title": "Our core services",
      "services.subtitle":
        "End‑to‑end financial solutions that drive efficiency, reduce risk and increase clarity at every step.",
      "services.learnMore": "Learn more",
  
      "services.items.accounting.title": "Ongoing accounting",
      "services.items.accounting.description":
        "Accurate recording of every transaction, reliable statements and a complete financial overview in time.",
      "services.items.tax.title": "Tax planning",
      "services.items.tax.description":
        "Optimised tax burden and full compliance with current legislation.",
      "services.items.payroll.title": "Payroll management",
      "services.items.payroll.description":
        "Accurate calculation of salaries, contributions and filings, on time and error‑free.",
      "services.items.consulting.title": "Strategic advisory",
      "services.items.consulting.description":
        "Financial analysis and growth strategies tailored to your business model.",
      "services.items.reporting.title": "Management reporting",
      "services.items.reporting.description":
        "Custom dashboards for management, cash‑flow and performance analysis.",
      "services.items.compliance.title": "Regulatory compliance",
      "services.items.compliance.description":
        "Monitoring deadlines and submissions to avoid fines and penalties.",
      "services.items.forecast.title": "Financial forecasting",
      "services.items.forecast.description":
        "Financial scenarios for investments, financing and sustainable expansion.",
  
      "categories.title": "Service categories",
      "categories.subtitle":
        "Filter by category to find the service that best fits the stage your business is in.",
      "categories.all": "All",
      "categories.accounting": "Accounting",
      "categories.taxes": "Taxes",
      "categories.payroll": "Payroll",
      "categories.consulting": "Consulting",
  
      "about.title": "About SADO Finance Consulting",
      "about.subtitle":
        "A team of accountants, financial analysts and business advisors working together to deliver clarity and confidence.",
      "about.text1":
        "We believe that every good decision starts with accurate data. That is why we built an approach where financial reporting, automation and human communication go hand in hand.",
      "about.text2":
        "From small businesses just starting out to established organisations, we help clients understand the numbers and turn them into actionable steps.",
      "about.point1":
        "Over 10 years of combined experience in finance and accounting.",
      "about.point2":
        "Transparent way of working and regular communication with clients.",
      "about.point3":
        "Modern technology for document management and online reporting.",
      "about.metric.number": "150+",
      "about.metric.label": "Businesses supported",
  
      "why.title": "Why work with us?",
      "why.subtitle":
        "We combine expertise, technology and a human approach to build long‑term partnerships.",
      "why.items.trust.title": "Trust and integrity",
      "why.items.trust.point1":
        "High professional standards and a strong work ethic.",
      "why.items.trust.point2":
        "Clear approval process for every critical decision.",
      "why.items.process.title": "Structured process",
      "why.items.process.point1":
        "Smooth onboarding and easy transfer of your data.",
      "why.items.process.point2":
        "Regular reporting and agreed timelines.",
      "why.items.care.title": "Human care",
      "why.items.care.point1":
        "Personalised guidance for every important decision.",
      "why.items.care.point2": "Fast responses and open communication.",
  
      "social.title": "Social responsibility",
      "social.subtitle":
        "We believe financial success should be shared with the community we operate in.",
      "social.items.education.title": "Education",
      "social.items.education.description":
        "We organise free workshops for young entrepreneurs and students in finance.",
      "social.items.local.title": "Local business",
      "social.items.local.description":
        "We collaborate with local businesses and offer favourable terms for start‑ups.",
      "social.items.environment.title": "Environment",
      "social.items.environment.description":
        "Reducing paper usage through fully digital processes.",
      "social.items.ethics.title": "Ethics & transparency",
      "social.items.ethics.description":
        "Clear rules of engagement and honest reporting on every financial matter.",
  
      "testimonials.title": "What our clients say",
      "testimonials.subtitle":
        "Businesses from different sectors that have trusted us with their accounts and financial plans.",
      "testimonials.items.1.quote":
        "“Thanks to their regular reporting and advice, we now have a completely different view of our profitability.”",
      "testimonials.items.1.name": "Arben Kola",
      "testimonials.items.1.role": "Owner of a trading business",
      "testimonials.items.2.quote":
        "“Our payroll process is automated and our team always receives accurate information on time.”",
      "testimonials.items.2.name": "Erisa Mema",
      "testimonials.items.2.role": "Head of Human Resources",
      "testimonials.items.3.quote":
        "“Their guidance on structuring our finances helped us secure crucial funding for expansion.”",
      "testimonials.items.3.name": "Luan Dervishi",
      "testimonials.items.3.role": "Co‑founder of a tech start‑up",
      "testimonials.items.4.quote":
        "“We feel confident before any tax inspection thanks to the complete documentation they prepare.”",
      "testimonials.items.4.name": "Eglantina Muka",
      "testimonials.items.4.role": "Chief Financial Officer",
  
      "finalCta.title": "Ready to bring clarity to your business finances?",
      "finalCta.subtitle":
        "Leave us a short message and we will contact you for an initial free consultation.",
      "finalCta.button": "Contact us",
  
      "contact.title": "Get in touch with our team",
      "contact.subtitle":
        "Fill in the form and we will come back with a tailored proposal within one business day.",
      "contact.phoneLabel": "Phone:",
      "contact.emailLabel": "Email:",
      "contact.addressLabel": "Address:",
      "contact.addressValue": "Yzberisht,Tirane, Albania",
  
      "form.nameLabel": "Full name",
      "form.namePlaceholder": "Enter your full name",
      "form.emailLabel": "Email",
      "form.emailPlaceholder": "Enter your email address",
      "form.messageLabel": "Message",
      "form.messagePlaceholder": "Tell us a bit more about what you need",
      "form.submit": "Send message",
  
      "form.error.required": "This field is required.",
      "form.error.email": "Please enter a valid email address.",
      "form.success":
        "Thank you! Your message has been sent. We will get back to you shortly.",
  
      "toast.serviceModalTitlePrefix": "More about: ",
  
      "footer.logo": "SADO Finance Consulting",
      "footer.about":
        "A team of professionals who see accounting not just as a legal requirement but as a tool for your business growth.",
      "footer.linksTitle": "Quick links",
      "footer.servicesTitle": "Services",
      "footer.contactTitle": "Contact",
      "footer.copyright":
        "© 2026 SADO Finance Consulting. All rights reserved.",
    },
  };
  
  const serviceDetails = {
    accounting: {
      al: {
        title: "Kontabilitet i përditësuar",
        body:
          "Menaxhojmë ciklin e plotë kontabël: nga regjistrimi ditor i transaksioneve, te pajtimet bankare dhe përgatitja e pasqyrave financiare. Punojmë me sisteme dixhitale që minimizojnë gabimet dhe ju kursejnë kohë.",
      },
      en: {
        title: "Ongoing accounting",
        body:
          "We take care of your full accounting cycle: from daily transaction posting to bank reconciliations and the preparation of financial statements. We use digital tools that minimise errors and save you time.",
      },
    },
    tax: {
      al: {
        title: "Planifikim tatimor",
        body:
          "Analizojmë strukturën tuaj tatimore, identifikojmë lehtësitë ligjore të aplikueshme dhe hartojmë një kalendar deklarimesh për të shmangur surprizat dhe gjobat.",
      },
      en: {
        title: "Tax planning",
        body:
          "We analyse your tax position, identify applicable legal incentives and design a filing calendar to avoid surprises and penalties.",
      },
    },
    payroll: {
      al: {
        title: "Administrim pagash",
        body:
          "Përgatisim listë‑pagesat, llogarisim kontributet dhe deklarimet sipas afateve. Stafi juaj merr dokumentacion të saktë, ndërsa ju keni transparencë të plotë mbi kostot e personelit.",
      },
      en: {
        title: "Payroll management",
        body:
          "We prepare payrolls, calculate contributions and submit all required filings on time. Your team receives accurate documentation and you gain full transparency over personnel costs.",
      },
    },
    consulting: {
      al: {
        title: "Konsulencë strategjike",
        body:
          "Ju ndihmojmë të lexoni shifrat përtej pasqyrave standarde. Së bashku identifikojmë burimet e fitimit, zonat e riskut dhe mundësitë për eficiencë më të madhe.",
      },
      en: {
        title: "Strategic advisory",
        body:
          "We help you read the numbers beyond standard reports. Together we identify profit drivers, risk areas and opportunities to improve efficiency.",
      },
    },
    reporting: {
      al: {
        title: "Raportim menaxherial",
        body:
          "Ndërtojmë raporte të personalizuara për menaxherët dhe aksionerët: analiza të fitueshmërisë, cash‑flow dhe tregues kyç për marrjen e vendimeve.",
      },
      en: {
        title: "Management reporting",
        body:
          "We design tailored reports for managers and shareholders: profitability analysis, cash‑flow and key indicators to support your decision‑making.",
      },
    },
    compliance: {
      al: {
        title: "Përputhshmëri ligjore",
        body:
          "Monitorojmë ndryshimet ligjore, afatet dhe procedurat që ndikojnë në biznesin tuaj dhe ju informojmë me kohë për çdo detyrim të ri.",
      },
      en: {
        title: "Regulatory compliance",
        body:
          "We keep track of legal changes, deadlines and procedures affecting your business and notify you in advance of any new obligations.",
      },
    },
    forecast: {
      al: {
        title: "Parashikim financiar",
        body:
          "Modele financiare për skenarë të ndryshëm rritjeje, financimi apo investimesh, që ju ndihmojnë të kuptoni ndikimin e vendimeve përpara se t’i merrni.",
      },
      en: {
        title: "Financial forecasting",
        body:
          "Financial models for different growth, financing and investment scenarios, helping you understand the impact of decisions before you take them.",
      },
    },
  };
  
  (function () {
    const html = document.documentElement;
    const langToggle = document.querySelector(".lang-toggle");
    const langOptions = document.querySelectorAll(".lang-option");
    const toastEl = document.querySelector(".toast");
  
    let currentLang = localStorage.getItem("lang") || "al";

    // Safety reset: avoid any restored UI state showing overlays/toasts on reload (bfcache).
    if (toastEl) {
      toastEl.classList.remove("visible", "error");
      toastEl.textContent = "";
    }
  
    function applyTranslations(lang) {
      const dict = i18n[lang];
      if (!dict) return;
  
      document
        .querySelectorAll("[data-i18n]")
        .forEach((el) => {
          const key = el.getAttribute("data-i18n");
          if (dict[key]) {
            el.textContent = dict[key];
          }
        });
  
      document
        .querySelectorAll("[data-i18n-placeholder]")
        .forEach((el) => {
          const key = el.getAttribute("data-i18n-placeholder");
          if (dict[key]) {
            el.placeholder = dict[key];
          }
        });
  
      document
        .querySelectorAll("[data-i18n-aria-label]")
        .forEach((el) => {
          const key = el.getAttribute("data-i18n-aria-label");
          if (dict[key]) {
            el.setAttribute("aria-label", dict[key]);
          }
        });
  
      const titleEl = document.querySelector("title[data-i18n]");
      const metaDesc = document.querySelector(
        'meta[name="description"][data-i18n]'
      );
      if (titleEl && dict[titleEl.dataset.i18n]) {
        titleEl.textContent = dict[titleEl.dataset.i18n];
      }
      if (metaDesc && dict[metaDesc.dataset.i18n]) {
        metaDesc.setAttribute("content", dict[metaDesc.dataset.i18n]);
      }
  
      html.lang = lang === "al" ? "sq" : "en";
  
      langOptions.forEach((opt) => {
        opt.classList.toggle("active", opt.dataset.lang === lang);
      });
    }
  
    function setLanguage(lang) {
      if (!i18n[lang]) return;
      currentLang = lang;
      localStorage.setItem("lang", lang);
      applyTranslations(lang);
    }
  
    applyTranslations(currentLang);
  
    if (langToggle) {
      langToggle.addEventListener("click", (e) => {
        const target = e.target.closest("[data-lang]");
        if (!target) return;
        const lang = target.dataset.lang;
        if (lang && lang !== currentLang) {
          setLanguage(lang);
        }
      });
    }
  
    /* Smooth scroll & nav active */
  
    const navLinks = document.querySelectorAll(".nav-link, .mobile-link");
    const headerOffset = 72;
  
    function smoothScrollTo(hash) {
      const target = document.querySelector(hash);
      if (!target) return;
      const rect = target.getBoundingClientRect();
      const offset = window.scrollY + rect.top - headerOffset;
      window.scrollTo({ top: offset, behavior: "smooth" });
    }
  
    navLinks.forEach((link) => {
      const href = link.getAttribute("href");
      if (href && href.startsWith("#")) {
        link.addEventListener("click", (e) => {
          e.preventDefault();
          const hash = href;
          smoothScrollTo(hash);
          closeMobileMenu();
        });
      }
    });
  
    const sections = Array.from(
      document.querySelectorAll("main section[id], header#home")
    );
    const desktopNavLinks = document.querySelectorAll(".nav-link");
  
    function updateActiveNav() {
      const scrollPos = window.scrollY + headerOffset + 1;
      let currentId = "home";
  
      sections.forEach((sec) => {
        const top = sec.offsetTop;
        if (scrollPos >= top) {
          currentId = sec.id || "home";
        }
      });
  
      desktopNavLinks.forEach((link) => {
        const href = link.getAttribute("href");
        const id = href && href.startsWith("#") ? href.slice(1) : null;
        link.classList.toggle("active", id === currentId);
      });
    }
  
    let ticking = false;
    window.addEventListener("scroll", () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          updateActiveNav();
          ticking = false;
        });
        ticking = true;
      }
    });
    updateActiveNav();
  
    /* Mobile menu */
  
    const menuToggle = document.querySelector(".menu-toggle");
    const mobileMenu = document.getElementById("mobile-menu");
  
    function closeMobileMenu() {
      if (!mobileMenu) return;
      mobileMenu.classList.remove("open");
      mobileMenu.setAttribute("aria-hidden", "true");
      if (menuToggle) {
        menuToggle.setAttribute("aria-expanded", "false");
      }
    }
  
    function openMobileMenu() {
      if (!mobileMenu) return;
      mobileMenu.classList.add("open");
      mobileMenu.setAttribute("aria-hidden", "false");
      if (menuToggle) {
        menuToggle.setAttribute("aria-expanded", "true");
      }
    }
  
    if (menuToggle && mobileMenu) {
      menuToggle.addEventListener("click", () => {
        const isOpen = mobileMenu.classList.contains("open");
        if (isOpen) {
          closeMobileMenu();
        } else {
          openMobileMenu();
        }
      });
  
      document.addEventListener("click", (e) => {
        if (!mobileMenu.classList.contains("open")) return;
        if (
          !mobileMenu.contains(e.target) &&
          !menuToggle.contains(e.target)
        ) {
          closeMobileMenu();
        }
      });
    }

    // Ensure menu is closed on load/reload.
    closeMobileMenu();
  
    /* Service filter pills */
  
    const pills = document.querySelectorAll(".pill");
    const serviceCards = document.querySelectorAll(".service-card");
  
    pills.forEach((pill) => {
      pill.addEventListener("click", () => {
        const filter = pill.dataset.filter || "all";
  
        pills.forEach((p) =>
          p.classList.toggle("active", p === pill)
        );
  
        serviceCards.forEach((card) => {
          const category = card.dataset.category;
          const match = filter === "all" || category === filter;
          card.classList.toggle("hidden-by-filter", !match);
        });
  
        const servicesSection = document.getElementById("services");
        if (servicesSection) {
          smoothScrollTo("#services");
        }
      });
    });
  
    /* Modal logic */
  
    const modalBackdrop = document.querySelector("[data-modal-backdrop]");
    const modal = modalBackdrop
      ? modalBackdrop.querySelector(".modal")
      : null;
    const modalTitle = modal ? modal.querySelector("#modal-title") : null;
    const modalBody = modal ? modal.querySelector(".modal-body") : null;
    const modalCloseBtn = modal ? modal.querySelector(".modal-close") : null;
    let lastFocusedElement = null;

    // Ensure modal is closed on load/reload.
    if (modalBackdrop) {
      modalBackdrop.hidden = true;
      modalBackdrop.style.display = "none";
    }
  
    function openModalFromService(serviceId) {
      if (!modalBackdrop || !modal || !modalTitle || !modalBody) return;
      const detail = serviceDetails[serviceId];
      if (!detail) return;
  
      const data = detail[currentLang];
      const prefix =
        i18n[currentLang]["toast.serviceModalTitlePrefix"] || "";
      modalTitle.textContent = prefix + data.title;
      modalBody.textContent = data.body;
  
      lastFocusedElement = document.activeElement;
  
      modalBackdrop.hidden = false;
      modalBackdrop.style.display = "flex";
  
      const focusable = getFocusableModalElements();
      if (focusable.length) {
        focusable[0].focus();
      }
  
      document.addEventListener("keydown", handleModalKeyDown);
    }
  
    function closeModal() {
      if (!modalBackdrop || !modal) return;
      modalBackdrop.hidden = true;
      modalBackdrop.style.display = "none";
      document.removeEventListener("keydown", handleModalKeyDown);
      if (lastFocusedElement && typeof lastFocusedElement.focus === "function") {
        lastFocusedElement.focus();
      }
    }
  
    function getFocusableModalElements() {
      if (!modal) return [];
      return Array.from(
        modal.querySelectorAll(
          'button, [href], input, textarea, [tabindex]:not([tabindex="-1"])'
        )
      ).filter((el) => !el.disabled && el.offsetParent !== null);
    }
  
    function handleModalKeyDown(e) {
      if (e.key === "Escape") {
        e.preventDefault();
        closeModal();
        return;
      }
      if (e.key === "Tab") {
        const focusable = getFocusableModalElements();
        if (!focusable.length) return;
        const first = focusable[0];
        const last = focusable[focusable.length - 1];
  
        if (e.shiftKey && document.activeElement === first) {
          e.preventDefault();
          last.focus();
        } else if (!e.shiftKey && document.activeElement === last) {
          e.preventDefault();
          first.focus();
        }
      }
    }
  
    if (modalBackdrop) {
      modalBackdrop.addEventListener("click", (e) => {
        if (e.target === modalBackdrop) {
          closeModal();
        }
      });
    }
  
    if (modalCloseBtn) {
      modalCloseBtn.addEventListener("click", closeModal);
    }
  
    document.querySelectorAll(".card-link[data-service-id]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-service-id");
        openModalFromService(id);
      });
    });
  
    /* IntersectionObserver reveal */
  
    const revealEls = document.querySelectorAll(".reveal");
    if ("IntersectionObserver" in window) {
      const io = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("visible");
              io.unobserve(entry.target);
            }
          });
        },
        { threshold: 0.15 }
      );
      revealEls.forEach((el) => io.observe(el));
    } else {
      revealEls.forEach((el) => el.classList.add("visible"));
    }
  
    /* Toast */
  
    let toastTimeout;
    function showToast(message, type = "success") {
      if (!toastEl) return;
      toastEl.textContent = message;
      toastEl.classList.remove("error");
      if (type === "error") {
        toastEl.classList.add("error");
      }
      toastEl.classList.add("visible");
      clearTimeout(toastTimeout);
      toastTimeout = setTimeout(() => {
        toastEl.classList.remove("visible");
      }, 3500);
    }
  
    /* Form validation */
  
    const contactForm = document.getElementById("contact-form");
    if (contactForm) {
      contactForm.addEventListener("submit", (e) => {
        e.preventDefault();
        const formData = new FormData(contactForm);
        const name = formData.get("name").trim();
        const email = formData.get("email").trim();
        const message = formData.get("message").trim();
  
        const dict = i18n[currentLang];
        const requiredMsg = dict["form.error.required"];
        const emailMsg = dict["form.error.email"];
  
        let isValid = true;
  
        function setError(field, msg) {
          const errSpan = contactForm.querySelector(
            `[data-error-for="${field}"]`
          );
          if (errSpan) {
            errSpan.textContent = msg;
          }
        }
  
        setError("name", "");
        setError("email", "");
        setError("message", "");
  
        if (!name) {
          setError("name", requiredMsg);
          isValid = false;
        }
        if (!email) {
          setError("email", requiredMsg);
          isValid = false;
        } else if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
          setError("email", emailMsg);
          isValid = false;
        }
        if (!message) {
          setError("message", requiredMsg);
          isValid = false;
        }
  
        if (!isValid) {
          showToast(requiredMsg, "error");
          return;
        }
  
        contactForm.reset();
        showToast(dict["form.success"], "success");
      });
    }
  
    /* Testimonials carousel */
  
    const slides = document.querySelectorAll(".testimonial-slide");
    const dots = document.querySelectorAll(".carousel-dot");
    const prevBtn = document.querySelector(".carousel-arrow.prev");
    const nextBtn = document.querySelector(".carousel-arrow.next");
    const carousel = document.querySelector(".carousel");
  
    let currentSlide = 0;
    let autoplayId = null;
    const autoplayDelay = 6000;
  
    function goToSlide(index) {
      if (!slides.length) return;
      currentSlide = (index + slides.length) % slides.length;
      slides.forEach((slide, i) => {
        slide.classList.toggle("active", i === currentSlide);
      });
      dots.forEach((dot, i) => {
        dot.classList.toggle("active", i === currentSlide);
        dot.setAttribute("aria-selected", i === currentSlide ? "true" : "false");
      });
    }
  
    function nextSlide() {
      goToSlide(currentSlide + 1);
    }
  
    function prevSlide() {
      goToSlide(currentSlide - 1);
    }
  
    function startAutoplay() {
      if (autoplayId) return;
      autoplayId = setInterval(nextSlide, autoplayDelay);
    }
  
    function stopAutoplay() {
      if (!autoplayId) return;
      clearInterval(autoplayId);
      autoplayId = null;
    }
  
    if (nextBtn) nextBtn.addEventListener("click", nextSlide);
    if (prevBtn) prevBtn.addEventListener("click", prevSlide);
    dots.forEach((dot) => {
      dot.addEventListener("click", () => {
        const idx = Number(dot.dataset.index || 0);
        goToSlide(idx);
      });
    });
  
    if (carousel) {
      carousel.addEventListener("mouseenter", stopAutoplay);
      carousel.addEventListener("mouseleave", startAutoplay);
  
      let touchStartX = null;
      carousel.addEventListener("touchstart", (e) => {
        touchStartX = e.changedTouches[0].clientX;
      });
      carousel.addEventListener("touchend", (e) => {
        if (touchStartX == null) return;
        const dx = e.changedTouches[0].clientX - touchStartX;
        if (Math.abs(dx) > 40) {
          if (dx < 0) nextSlide();
          else prevSlide();
        }
        touchStartX = null;
      });
  
      startAutoplay();
    }
  })();
